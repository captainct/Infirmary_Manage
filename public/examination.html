<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ห้องตรวจ</title>
    <link rel="stylesheet" href="css/examination.css" />
    <link rel="stylesheet" href="css/sidebar.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>
  <body>
  <div class="app-container">
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <span class="menu-icon"><i class="fa-solid fa-stethoscope"></i></span>
        <div class="logo-text">IMS</div>
      </div>
      <div class="sidebar-menu">
        <a href="/dashboard.html" class="menu-item"><span class="menu-icon"><i class="fas fa-chart-line"></i></span><span>แดชบอร์ด</span></a>
        <a href="patients.html" class="menu-item"><span class="menu-icon"><i class="fas fa-user-plus"></i></span><span>ลงทะเบียนผู้ป่วยใหม่</span></a>
        <a href="examination.html" class="menu-item active"><span class="menu-icon"><i class="fas fa-user-md"></i></span><span>บันทึกการตรวจรักษา</span></a>
        <a href="patients_list.html" class="menu-item"><span class="menu-icon"><i class="fas fa-clipboard-list"></i></span><span>ค้นหาประวัติผู้ป่วย</span></a>
        <a href="medicines_list.html" class="menu-item "><span class="menu-icon"><i class="fas fa-capsules"></i></span><span>จัดการข้อมูลยา</span></a>
      </div>
      <div class="sidebar-footer">
        <a href="login.html" class="logout-btn"><i class="fas fa-sign-out-alt"></i><span>ออกจากระบบ</span></a>
      </div>
    </div>
    <div class="main-content">
      <div class="container">
        <div class="page-header">
          <h2>บันทึกการตรวจรักษาและจ่ายยา</h2>
        </div>

        <div class="form-container">
          <div class="step-indicator">
            <div class="step active" id="step-indicator-1">
              <div class="step-circle">1</div>
              <div class="step-label">บันทึกข้อมูลผู้ป่วยเบื้องต้น</div>
            </div>
            <div class="step" id="step-indicator-2">
              <div class="step-circle">2</div>
              <div class="step-label">บันทึกผลการตรวจรักษา</div>
            </div>
            <div class="step" id="step-indicator-3">
              <div class="step-circle">3</div>
              <div class="step-label">รายการจ่ายยา</div>
            </div>
          </div>

          <!-- Message Area -->
          <div id="message" class="message"></div>

          <!--  STEP 1: บันทึกข้อมูลผู้ป่วยเบื้องต้น  -->
          <div id="step-1" class="step-content show">
            <div class="patient-search">
              <h4>ค้นหาผู้ป่วย</h4>
              <div class="form-row">
                <div class="form-group">
                  <input
                    type="text"
                    id="search-input"
                    placeholder="ใส่รหัสพนักงานหรือชื่อ-นามสกุล"
                  />
                </div>
                <div class="form-group"></div>
              </div>

              <div id="search-result" class="search-result">
                <p>ผลการค้นหาจะแสดงที่นี่</p>
              </div>
            </div>

            <h4>ค่าพื้นฐาน</h4>
            <div class="form-row">
              <div class="form-group">
                <label>ความดันโลหิต</label>
                <input
                  type="text"
                  id="blood-pressure"
                  placeholder="เช่น 120/80"
                />
              </div>
              <div class="form-group">
                <label>อุณหภูมิ (°C)</label>
                <input
                  type="number"
                  id="temperature"
                  step="0.1"
                  min="35"
                  max="45"
                />
              </div>
            </div>

            <div class="form-group">
              <label>ประเภทการมาใช้บริการ *</label>
              <select id="service-type" required>
                <option value="">-- เลือกประเภท --</option>
                <option value="medicine">ตรวจรักษา</option>
                <option value="wound_care">ทำแผล</option>
              </select>
            </div>

            <div class="form-group">
              <label>อาการที่มาพบแพทย์/พยาบาล *</label>
              <textarea
                id="symptoms"
                rows="4"
                placeholder="บันทึกอาการที่ผู้ป่วยมาพบแพทย์"
                required
              ></textarea>
            </div>
          </div>

          <!--  STEP 2: บันทึกผลการตรวจรักษา  -->
          <div id="step-2" class="step-content">
            <h4>จัดกลุ่มการวินิจฉัย</h4>
            <p>เลือกหมวดการวินิจฉัยที่ตรงกับอาการของผู้ป่วย</p>
            <div class="diagnosis-categories">
              <div class="category-item" onclick="selectCategory('nervous')">
                <h5>Nervous</h5>
                <p>ระบบสมอง</p>
              </div>
              <div class="category-item" onclick="selectCategory('eye')">
                <h5>Eye</h5>
                <p>ตา</p>
              </div>
              <div class="category-item" onclick="selectCategory('ear')">
                <h5>Ear</h5>
                <p>หู</p>
              </div>
              <div
                class="category-item"
                onclick="selectCategory('teeth_mouth')"
              >
                <h5>Teeth & Mouth</h5>
                <p>ฟันและช่องปาก</p>
              </div>
              <div
                class="category-item"
                onclick="selectCategory('respiratory')"
              >
                <h5>Respiratory</h5>
                <p>ระบบทางเดินหายใจ</p>
              </div>
              <div class="category-item" onclick="selectCategory('alimentary')">
                <h5>Alimentary</h5>
                <p>ระบบทางเดินอาหาร</p>
              </div>
              <div class="category-item" onclick="selectCategory('urinary')">
                <h5>Urinary</h5>
                <p>ระบบปัสสาวะ</p>
              </div>
              <div class="category-item" onclick="selectCategory('ob_gyn')">
                <h5>OB-GYN</h5>
                <p>สูติ-นรีเวช</p>
              </div>
              <div class="category-item" onclick="selectCategory('ortho')">
                <h5>Ortho</h5>
                <p>กระดูก</p>
              </div>
              <div class="category-item" onclick="selectCategory('skin')">
                <h5>Skin</h5>
                <p>ผิวหนัง</p>
              </div>
              <div class="category-item" onclick="selectCategory('dressing')">
                <h5>Dressing</h5>
                <p>ทำแผล</p>
              </div>
            </div>

            <input type="hidden" id="selected-category" value="" />

            <div class="form-group">
              <label>แนบรูปประกอบ (ถ้ามี)</label>
              <input type="file" id="photo-input" accept="image/*" />
              <div id="photo-preview"></div>
            </div>

            <!-- Patient Status -->
            <div class="form-group">
              <label>สถานะผู้ป่วย</label>
              <select id="patient-status" onchange="toggleObservationNotes()">
                <option value="discharged">กลับทำงาน</option>
                <option value="observation">นอนพักเพื่อสังเกตอาการ</option>
              </select>
            </div>

            <div id="observation-notes" class="form-group hidden">
              <label>หมายเหตุการสังเกตอาการ</label>
              <textarea
                id="observation-text"
                rows="3"
                placeholder="บันทึกรายละเอียดการสังเกตอาการ..."
              ></textarea>
            </div>
          </div>

          <!--  STEP 3: รายการจ่ายยาและค่าใช้จ่าย  -->
          <div id="step-3" class="step-content">
            <div class="medicine-section">
              <h4>เลือกรายการยา</h4>
              <div class="medicine-multiselect">
                <div class="form-row">
                  <div class="form-group" style="flex: 2">
                    <label>เลือกยา</label>
                    <div class="medicine-input-container">
                      <input
                        type="text"
                        id="medicineSearchInput"
                        placeholder="พิมพ์หรือค้นหายา"
                        class="medicine-search-input"
                      />
                    </div>
                    <div
                      class="medicine-dropdown"
                      id="medicineDropdown"
                      style="display: none"
                    >
                      <div id="medicineOptions"></div>
                    </div>
                  </div>

                  <div class="form-group">
                    <label>จำนวน</label>
                    <input
                      type="number"
                      id="medicine-quantity"
                      min="1"
                      max="100"
                      placeholder="0"
                    />
                  </div>
                </div>
              </div>

              <button
                type="button"
                class="btn btn-primary"
                onclick="addMedicineFromDropdown()"
              >
                + เพิ่มยา
              </button>

              <div class="selected-medicines">
                <h4>รายการยาที่จ่าย</h4>
                <div id="medicine-list">ยังไม่มีรายการยา</div>
                <div style="margin-top: 10px; font-weight: bold"></div>
              </div>
            </div>

            <h4>ลายเซ็นรับรอง</h4>
            <div class="form-row">
              <div class="form-group">
                <label>ลายเซ็นพยาบาล</label>
                <div class="signature-area">
                  <canvas
                    id="staff-signature"
                    class="signature-canvas"
                    width="300"
                    height="120"
                  ></canvas>
                </div>
                <button
                  type="button"
                  class="btn btn-secondary"
                  onclick="clearSignature('staff')"
                >
                  ล้างลายเซ็น
                </button>
              </div>

              <div class="form-group">
                <label>ลายเซ็นผู้รับบริการ (จำเป็น) *</label>
                <div class="signature-area">
                  <canvas
                    id="patient-signature"
                    class="signature-canvas"
                    width="300"
                    height="120"
                  ></canvas>
                </div>
                <button
                  type="button"
                  class="btn btn-secondary"
                  onclick="clearSignature('patient')"
                >
                  ล้างลายเซ็น
                </button>
              </div>
            </div>
          </div>

          <!-- ปุ่มไปกลับ -->
          <div class="navigation">
            <button
              type="button"
              class="btn btn-secondary"
              id="prev-btn"
              onclick="previousStep()"
              style="display: none"
            >
              ← ย้อนกลับ
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="next-btn"
              onclick="nextStep()"
            >
              ถัดไป →
            </button>
            <button
              type="button"
              class="btn btn-success"
              id="save-btn"
              onclick="saveExamination()"
              style="display: none"
            >
              บันทึกการตรวจรักษา
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="js/examination_utils.js"></script>
    <script src="js/examination_signature.js"></script>
    <script src="js/examination_patient_search.js"></script>
    <script src="js/examination_medicine.js"></script>
    <script src="js/examination_steps.js"></script>
    <script src="js/examination.js"></script>
  </body>
</html>